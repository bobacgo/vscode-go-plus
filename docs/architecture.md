# Go++ 扩展架构文档

## 项目概述

Go++ 是一个 VS Code 扩展，专为 Go 语言开发者设计，主要功能是提供 Go 模块依赖的可视化和浏览。扩展允许用户直接在 VS Code 中查看和导航 Go 项目的依赖关系，包括第三方依赖库的源代码。

## 项目结构

```
gopp/
├── docs/                    # 文档目录
├── resources/               # 资源文件，如图标
├── scripts/                 # 构建和辅助脚本
├── src/                     # 源代码
│   ├── extension.ts         # 扩展入口点
│   └── ...
├── test/                    # 测试目录
├── package.json             # 扩展配置和依赖
└── tsconfig.json            # TypeScript 配置
```

## 主要模块

### 1. 扩展入口 (extension.ts)

扩展的主入口点，负责：

- 初始化各个功能模块
- 注册命令和视图
- 设置事件监听
- 激活和释放资源

### 2. 模块树提供器 (tree.ts)

核心组件，实现了以下功能：

- 解析和展示 Go 项目的 `go.mod` 文件
- 显示项目的依赖关系层次结构
- 支持浏览第三方依赖的源代码
- 监控 `go.mod` 文件变化并更新视图

主要类：

- `ModTree`: 实现了 TreeDataProvider 接口，提供树形结构数据
- `ModItem`: 表示树中的各类节点（模块、包、文件等）

### 3. 命令和功能

扩展提供以下主要功能：

1. **模块依赖视图**: 直观展示项目依赖
2. **依赖源码浏览**: 支持浏览第三方依赖的源代码
3. **Go SDK 浏览**: 允许浏览标准库源码
4. **依赖更新监控**: 监控依赖变化并自动更新视图

## 数据流

1. **初始化流程**:

   - 扩展激活 -> 创建 ModTree 实例 -> 解析工作空间 go.mod 文件 -> 生成依赖树
2. **依赖解析流程**:

   - 解析 go.mod 文件 -> 提取 require 和 replace 块 -> 构建依赖关系 -> 生成树节点
3. **源码浏览流程**:

   - 用户选择依赖 -> 查询模块缓存位置 -> 读取源文件 -> 显示内容

## 关键技术

1. **Go 环境交互**:

   - 使用命令行工具获取 Go 环境信息（GOPATH, GOMODCACHE）
   - 执行 `go list` 命令获取模块详细信息
2. **文件系统操作**:

   - 读取和解析 go.mod 文件
   - 遍历目录结构，获取源文件列表
   - 处理模块缓存中的文件访问
3. **VS Code API 使用**:

   - TreeDataProvider 实现自定义树视图
   - TextDocumentContentProvider 提供虚拟文档内容
   - 命令注册和事件监听

## 扩展点和配置

扩展通过 package.json 定义了以下扩展点：

1. **视图容器和视图**:

   - golibrary.golibraryView: Go 模块浏览视图
2. **命令**:

   - golibrary.refreshTreeView: 刷新树视图
   - golibrary.openModule: 打开模块源码
3. **配置选项**:

   - 自动刷新
   - 焦点模式
